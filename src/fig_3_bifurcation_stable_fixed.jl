include("dependencies.jl")

model_params = make_model_parameters(
    k = baseline_k, beta = baseline_beta, gamma = baseline_gamma,
    a = baseline_a, r = 0.003,
    b = baseline_b, h = baseline_h, c_jump_dist = baseline_c_jump_dist
)

n_days = 10000
seq_t = collect(0:n_days)


u0_fixed = get_steady_state(model_params)

using Random
rng = MersenneTwister(3)

u0_noisy = u0_fixed .+ rand(rng, LogNormal(-4.8, 1), model_params.S + 1)
u0_noisy = u0_noisy / sum(u0_noisy)

# For reproducibility:
u0_noisy = [0.3060685856841382, 0.021225285948145937, 0.017766842934197412, 0.07233479992510922, 0.015342296313641986, 0.01962279591021129, 0.0163469842059887, 0.0180092478596523, 0.04012262739581338, 0.024816890905423526, 0.027843050322379572, 0.03227362918555889, 0.024683230571268745, 0.025396043150553167, 0.023662708410686833, 0.022115774463532564, 0.022726253235105704, 0.02569470770484977, 0.026355497812977826, 0.026222171728118124, 0.027341744828100784, 0.027112622172267543, 0.017387287188794426, 0.014615912979557645, 0.014042018026940604, 0.013250227171055765, 0.016546603950819302, 0.009472180751370652, 0.016017414129455704, 0.004644561635689398, 0.006903662491278158, 0.004398956061164688, 0.011660226964316104, 0.007977157981836121]

ode_solution = @time ode_solve(model_params, n_days, 0, u0 = u0_noisy);

sus, inf, inc = get_results(ode_solution, seq_t, model_params)

jldsave("data/paper/bifurcation_stable_fixed.jld2"; seq_t, inf)